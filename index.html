<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
			,
			interactive-widget="resizes-content"
		/>
		<meta name="description" content="Basic HTML/CSS/JS site skeleton" />
		<title>Message Simulator</title>

		<!-- Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Public+Sans:ital,wght@0,100..900;1,100..900&display=swap"
			rel="stylesheet"
		/>

		<!-- Theme -->
		<script>
			(() => {
				const STORAGE_KEY = 'message-simulator:theme';
				const root = document.documentElement;

				const getSavedTheme = () => {
					try {
						return localStorage.getItem(STORAGE_KEY);
					} catch (_e) {
						return null;
					}
				};

				const applyTheme = (theme) => {
					if (theme === 'dark' || theme === 'light') {
						root.setAttribute('data-theme', theme);
					} else {
						root.removeAttribute('data-theme');
					}
				};

				const mql =
					window.matchMedia &&
					window.matchMedia('(prefers-color-scheme: dark)');

				const syncToSystemIfNoOverride = () => {
					const saved = getSavedTheme();
					if (saved === 'dark' || saved === 'light') return;
					applyTheme(mql && mql.matches ? 'dark' : 'light');
				};

				// Initial theme: saved override, else system
				const saved = getSavedTheme();
				if (saved === 'dark' || saved === 'light') applyTheme(saved);
				else syncToSystemIfNoOverride();

				// Live-update when OS theme changes (only when no saved override)
				if (mql) {
					const onChange = () => syncToSystemIfNoOverride();
					if (typeof mql.addEventListener === 'function') {
						mql.addEventListener('change', onChange);
					} else if (typeof mql.addListener === 'function') {
						mql.addListener(onChange);
					}
				}
			})();
		</script>
		<link rel="stylesheet" href="./styles.css" />
	</head>
	<body>
		<main id="app" class="app-container">
			<section class="pane pane--threads">
				<thread-list></thread-list>
			</section>
			<section class="pane pane--editor">
				<thread-editor></thread-editor>
			</section>
			<section class="pane pane--preview">
				<thread-preview></thread-preview>
			</section>
		</main>
		<footer class="footer">
			<p>
				Made by
				<a href="https://peterchinman.com" target="_blank">Peter Chinman</a>.
				See this project on GitHub
				<a
					href="https://github.com/peterchinman/message-simulator"
					target="_blank"
					>here</a
				>.
			</p>
		</footer>
		<script type="module" src="./components/thread-list.js"></script>
		<script type="module" src="./components/thread-editor.js"></script>
		<script type="module" src="./components/thread-preview.js"></script>
		<script type="module" src="./app.js"></script>
	</body>
</html>
